generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}


// ! Users       =============================================================================

model Users {
  id                String         @id @default(auto()) @map("_id") @db.ObjectId

  firstName         String
  lastName          String
  email             String          @unique
  role              Roles
  avatar            String?
  password          String

  city              String
  state             String
  zipCode           Int

  // m-to-n
  childIDs String[]   @db.ObjectId
  children  Children[]   @relation(fields: [childIDs], references: [id])

  eventIDs String[] @db.ObjectId
  events Events[] @relation(fields: [eventIDs], references: [id])

  createdAt         DateTime
  updatedAt         DateTime

  // One-to-m
  notifications     Notifications[]
  reviews           Reviews[]


}

enum Roles {
  parent
  admin
  instructor
}

model Notifications {
  id                    String  @id @default(auto()) @map("_id") @db.ObjectId
  description           String

  user   Users   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId
}


model Children {
  id                    String  @id @default(auto()) @map("_id") @db.ObjectId
  firstName             String
  lastName              String
  homeschool            Boolean
  age                   Int

  parentIDs String[] @db.ObjectId
  parents   Users[]   @relation(fields: [parentIDs], references: [id])

  eventIDs String[] @db.ObjectId
  events Events[] @relation(fields: [eventIDs], references: [id])

  createdAt         DateTime
  updatedAt         DateTime
}

// ! Activities     =============================================================================

model Activities {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  name          String      @unique
  description   String

  events        Events[]
}

// ! Events         =============================================================================

model Events {
    id          String      @id @default(auto()) @map("_id") @db.ObjectId

    childIDs  String[] @db.ObjectId
    children  Children[] @relation(fields: [childIDs], references: [id])

    userIDs   String[] @db.ObjectId
    users     Users[] @relation(fields: [userIDs], references: [id])

    activity    Activities   @relation(fields: activityId, references: [id])
    activityId  String      @db.ObjectId

    reviews     Reviews[]

    createdAt         DateTime
    updatedAt         DateTime
}

// ! reviews        =============================================================================

model Reviews {
    id          String      @id @default(auto()) @map("_id") @db.ObjectId
    rating      Int

    event       Events       @relation(fields: eventId, references: [id])
    eventId     String      @db.ObjectId

    parent      Users        @relation(fields: [parentId], references: [id])
    parentId    String      @db.ObjectId
}
